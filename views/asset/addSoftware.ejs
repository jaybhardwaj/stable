<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
        <% include assetheader %>
            <% include ../partials/adminheader %>
    <style type="text/css">
             .marginLeftRight
             {
                margin-left: -27%;
                width: 116%;   
              }
    </style>          
</head>

<body style="overflow-x:hidden">

    <div class="secondry-color">
      <span class="fusion-page-title">Add Software</span>
        <div class="row">
        <span title="Go To Software List" onclick="document.location.href='/viewSoftware';" style="float:left;width: 25px;height: 30px;font-size: 20px;color:green;padding-left: 30px;"  class="glyphicon glyphicon-arrow-left"></span>
            
        </div>
        <form class="form-horizontal" action="submitSoftwareDetails" method="post">
            <div class="row fusion-form-elements">
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Software Type:<sup  class="astrick">*</sup></label>
                <select id="typel" type="dropdown" name="stype" class="form-control input-sm">
                  <option disabled value="0"selected="">Select a value</option>
                    <%for(var i=0;i<stype[0].length;i++){%>
                  <option value="<%=stype[0][i].id%>"><%=stype[0][i].componentName%></option>
                    <%}%>
                </select>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Vendor:<sup  class="astrick">*</sup></label>
                <select id="vendor" type="dropdown" name="vendor" class="form-control input-sm">
                  <option disabled value="0"selected="">Select a value</option>
                    <%for(var i=0;i<stype[2].length;i++){%>
                  <option value="<%=stype[2][i].id%>"><%=stype[2][i].name%></option>
                    <%}%>
                </select>
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Licence:</label>
                <input type="checkbox" name='test5' id="test5" />
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Name:<sup  class="astrick">*</sup></label>
                <input name="name" type="text" placeholder="software name" class="form-control input-sm" id="name">
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Invoice Date:<sup  class="astrick">*</sup></label>
                <input name="Invoicedate" placeholder="Enter date" class="form-control input-sm date" id="Invoicedate">
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Description:<sup  class="astrick">*</sup></label>
                <textarea id='textarea' placeholder="description of software" name="des" style="resize: none;" class="form-control input-sm"></textarea>
              </div>
            </div>
           
            <div class="row fusion-form-elements hide" id="lic">
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>#Users:<sup  class="astrick">*</sup></label>
                <input type="number" name="users"  min="1" placeholder="no. of users" class="form-control input-sm"  id="users"   onchange="addlic()">
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Purchase Date:<sup  class="astrick">*</sup></label>
                <input name="pdate" class="form-control input-sm date" placeholder="Enter date" id="pdate">
              </div>
              <div class="col-lg-3 col-md-3 col-sm-4">
                <label>Expiry Dat:<sup  class="astrick">*</sup></label>
                <input name="edate" placeholder="Enter date" class="form-control input-sm date" id="edate">
              </div>
            </div>
            <div id="hidden-fields" class="row fusion-form-elements jay"></div>
         
            <div class="row" id="license" style="max-width: 100% overflow-y:auto" ></div>
            <input type='text' id="hid" class='hide' name='alllicensekey' value="1">
            <div class="form-group" style="margin: 20px">
                <div align="center">
                    <button type="submit" onclick="return validate()" class="btn btn-primary">Submit</button>
                    <a href="/viewSoftware" type="button" class="btn btn-primary">Cancel</a>
                </div>
            </div>
        </form>
    </div>

    <% include ../partials/footer %>
        <script>
            $(document).ready(function() {
                $('.asset-img').addClass('active');
            });
            jQuery('.date').datetimepicker({
                timepicker: false,
                format: 'd/m/Y'
            });
             
             function copytoall() 
             {
                  var a=$('#lic0').val();
                  var us=$('#users').val();
                 
               if ($("#check").is(':checked')) 
                {
                  var a=$('#lic0').val();
                  var us=$('#users').val();
                  for( var i=1;i<=us;i++)
                    {
                      $('#lic'+ i).val(a);
                     }
                  }
                 else
                  {
                     for( var i=1;i<=us;i++)
                    {
                      $('#lic'+ i).val('');
                     }
                  } 
              } 

             $('#test5').click(function() 
             {
                 if ($(this).is(':checked')) 
                 {
                        if ($('#typel').val() === null) 
                          {
                           alert("Please select the software type first!");
                           return false;
                          } 
                        else 
                        {
                         $('#lic').removeClass('hide');
                        }
                  } 
                  else {
                     $('#lic').addClass('hide');
                      $('#users').val('');
                      $('#pdate').val('');
                      $('#edate').val('');
                      $("#license").html('');
                       }
              });

            function validate() 
            {
                   var to = $('#pdate').val().split("/");
                   var purch = new Date(to[2], to[1] - 1, to[0]);
                   var inv= $('#Invoicedate').val().split("/");
                   var invoice = new Date(inv[2], inv[1] - 1, inv[0]);
                   var too = $('#edate').val().split("/");
                   var exdate = new Date(too[2], too[1] - 1, too[0]);

                var us = $('#users').val();
              
             if ($('#typel').val() === null) 
               {
                    alert("Please select the software type first!");
                    return false;
                } 
             
             
               
              if ($('#vendor').val() === null) 
                {
                    alert("vendor is Missing!");
                    return false;
                }
                if ($('#name').val().length < 1 || $.trim($("#name").val()) == "") 
                {
                    alert("Name is Missing!");
                    return false;
                }
                if ($('#Invoicedate').val().length < 1 || $.trim($("#Invoicedate").val()) == "") 
                {
                    alert("Invoice date is Missing!");
                    return false;
                }
                if ($('#textarea').val().length < 1 || $.trim($("#textarea").val()) == "") 
                {
                    alert("Description is Missing!");
                    return false;
                }
                if ($('#test5').prop('checked')) 
                {
                
                    for(var i=0;i<us;i++)
                    {
                      if ($("#lic"+ i ).val().length < 1 || $.trim($("#lic"+ i).val()) == "") 
                       {
                        alert("Licence key is Missing!");
                        return false;
                       }
                    } 
                
                   if ($('#pdate').val().length < 1 || $.trim($("#pdate").val()) == "") 
                    {
                        alert("Licence  date is Missing!");
                        return false;
                    }

                     
                    if ( purch<invoice) 
                       {
                         alert("purchase date cannot be less then invoice date!");
                          return false;
                       }


                    if (us.length < 1 || isNaN(us) || us.trim().length < 0) 
                    {
                        alert("Enter valid number of Users!");
                        return false;
                    }
                    if ($('#edate').val().length < 1 || $.trim($("#edate").val()) == "") 
                    {
                        alert("Expiry  date is Missing!");
                        return false;
                    }

                    if (exdate<purch) 
                      {
                        alert("expiry date cannot be less then purchase date!");
                        return false;
                       }

                    if (exdate<invoice) 
                      {
                        alert("expiry date cannot be less then purchase date!");
                        return false;
                       }
                        
                    var arr=[];
                    for( var i=0;i<us;i++)
                    {
                     
                      var licensekey=myFunction($("#lic"+ i ).val());
                      arr.push(licensekey);
                  

                    }
                    $('#hid').val(arr);
                    alert(arr);
                   
                  


                }
         
                alert("Software successfully added!");
            }


           function addlic() {
    $(".jay").html('');
    var typ=$('#users').val();
    if (typ == "0") 
    {
        alert("This value can not be zero");
        return false;
    }
    if ($('#users').val().length < 1 || $.trim($("#users").val()) < 1 || $('#users').val()>30) 
    {
        alert("Please enter valid number of users! max num of users can be 30");
        $('#users').val('');
        return false;
    }
   
      if($('#users').val()>1)
      {
       
        var logstr='<div style="min-height: 0px;padding-left: 15px;"><label>Copy 1st key to all</label><input type="checkbox" id="check" onclick="copytoall()"></div>';

       }
       
        if($('#users').val()==1)
        {
         var logstr='';    
          }       
                  for(var i=0;i<typ;i++)
                  {
                    k=i+1;
                    if(i%3==0)
                    {
                      if(i!=0){
                        logstr=logstr+'</tr>';
                    }
    
                    logstr=logstr+'<div class="col-lg-3 col-md-3 col-sm-4"><label>Licence Key:'+ k +' <sup class="astrick">*</sup> </label><input type="text" class="form-control input-sm" id="lic'+ i +'" ></div>';  
                   
                    }
                    else{
                           
                    
                    logstr=logstr+'<div class="col-lg-3 col-md-3 col-sm-4"><label>Licence Key:'+ k +' <sup class="astrick">*</sup> </label><input type="text" class="form-control input-sm" id="lic'+ i +'" ></div>';   
                  }
              }
             
                $('#hidden-fields').append(logstr);  
        
  
      
}

function makeid()
{
    var text = "";
    var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

    for( var i=0; i < 10; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));

    return text;
}
function myFunction(avalue) {
    var str = avalue;
    var len=avalue.length;
var lic=str;
var first=lic.substring(0,1);
var secont=lic.substring(1,len);
var sddmost=makeid();
var firstco=first.concat(sddmost);
var final=firstco.concat(secont);
return final;

}

function myFunction1(str1) {
    var str = str1
    var n = str.length;
var lic=str;
var first=lic.substring(0,0);
var secont=lic.substring(9,n);
var finals=first.concat(secont);
    return finals;
}

        </script>
