<!DOCTYPE html>
<html lang="en">
   <% include ../partials/head %>
   <title>Polestar Timesheet</title>
   <meta charset="utf-8">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <style>
   .marginR10 {
    margin-right: 10px;
   }
      .text-hover:hover{
      background-color: #ffb3b3;
      }
      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
      }
      input[type=number] {
      -moz-appearance:textfield;
      }
      .labelHead {
      color: white;
      }
      .scrollit{
      overflow:scroll; 
      height:auto; 
      width:977px;
      }
      .heart {
      font-size: 150px;
      color: #e00;
      animation: beat .25s infinite alternate;
      transform-origin: center;
      }
      @keyframes beat{
      to { transform: scale(1.4); }
      }
      .chosen-container .chosen-container-single{
    margin-left: -41px !important;
      }
      #timesheet-table2 #for_approv_wrapper{
        max-width: 1000px;
      }
      #OtherEmp .chosen-container{
        max-width: 220px;
      }
   </style>
   <script>
        var resettimesheetBtn='<button type="button" id="resettimesheet" class="btn marginR10" onClick="ClearAll()">Reset</button>';
        var savetimesheetBtn='<button type="button" class="btn marginR10" id="savetimesheet" onClick="Totalsum(1)">Save</button>';
        var submitTimesBtn ='<input id="submitTimes" type="button" style=" " class="btn marginR10" onClick="Totalsum(2)" value="Submit">';
        var submitedTimesBtn ='<input id="submitedTimes" type="button" style=" " class="btn" value="Submitted" disabled>';
      var new1;
      var t = '';
      var no_of_asgmnt = 0;
      var curr_wbsnm = [];
      var curr_asgnmnt_id = [];
      var curr_wbs_id = [];
      var report_data=[];
      
      
      
      if('<%=timeinfo[8][0].timesheetSpan%>'==1 || '<%=timeinfo[8][0].timesheetSpan%>'=='')
      {
      var ftdy =1;
      var weekdy = 0;
      var monthly=0;
      }
      else
       if('<%=timeinfo[8][0].timesheetSpan%>'==0)
      {var ftdy =0;
      var weekdy = 1;
      var monthly=0;
       }
      else
      {
      var ftdy =0;
      var weekdy = 0;
      var monthly=1;
      }
      if('<%=timeinfo[8][0].workinghours%>'!='')
      {
      var workschedule='<%=timeinfo[8][0].workinghours%>';
      }else
      {
          var workschedule=9;
      }
      var st1, ed1;
     
      var save_not_submit;
      var initial = 0;
      var temp;
      var userId;
      var alldays = ["Day1", "Day2", "Day3", "Day4", "Day5", "Day6", "Day7", "Day8", "Day9", "Day10", "Day11", "Day12", "Day13", "Day14", "Day15", "Day16", "Day17", "Day18", "Day19", "Day20", "Day21", "Day22", "Day23", "Day24", "Day25", "Day26", "Day27", "Day28", "Day29", "Day30", "Day31", "total"];
      var weekdays = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];
      var flag = 0;
      var for_status = ["Draft", "Active", "Pending for Approval", "Approved", "Rejected"];
      var flag = 0;
      var dy = "";
      var year = "";
      var mon = "";
      var a, b, c;
      var curr = '';
      var sdate;
      var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      $(document).ready(function() {
      
         
     



          $(".se-pre-con").fadeOut("slow");
          
       otable=$('#for_approv').dataTable({
                             "bInfo": false,"bLengthChange":false
                           });
          if(('<%=timeinfo[8][0].schedule%>'==''||'<%=timeinfo[8][0].workinghours%>'==''||'<%=timeinfo[8][0].timesheetSpan%>'=='') && '<%=timeinfo[3][0].isRetailer%>'!=''){
              alert("Fill the required informations Working Hours and Timsheet Span in Masters");
              window.location.href="/masters?timesheet=1";
      
          }
          else
          {   
              if('<%=timeinfo[3][0].isRetailer%>'=='' && ('<%=timeinfo[8][0].schedule%>'==''||'<%=timeinfo[8][0].workinghours%>'==''||'<%=timeinfo[8][0].timesheetSpan%>'==''))
             { alert("Please Contact Admin");
                window.location.href="/bugHome";}
          }
      
          $('.modulemenu').removeClass('active');
          $('.portal-menu').addClass('hide');
          $('.timesheet-tab').addClass("active");
      
          $(".ui-datepicker-trigger img").css("width", "25px");
          var retDate=new Date('<%=timeinfo[10][0].createdDate%>');
      
     
          $('#submitdate').datepicker({
              minDate: retDate,
              onSelect: function(dateText, inst) {
                    $(".fadeLeftIcon").addClass("hide");
      $(".leftIcon").removeClass("hide");
                  adjustdays();
                  OtherUsersLIst();
              }
          });
      
          $('#StartDate').on('click', function() {
              document.getElementById("submitdate").disabled=false;
              $('#submitdate').focus();
              document.getElementById("submitdate").disabled=true;
          });
       
          curr = new Date();
          var s = curr.toString();
          a = curr.getDate();
          b = curr.getMonth();
          c = curr.getFullYear();
          var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
          abc(c, b + 1, a);
      
          function adjustdays() {
              var d = $('#submitdate').val().toString();
              year = d[6] + d[7] + d[8] + d[9];
              dy = d[3] + d[4];
              mon = d[0] + d[1];
              abc(year, mon, dy);
          }
      
         
      if('<%=flag_owntimesheet%>'==1)
      {
      showDiv();
      }
      
      
      
      });
      userId = <%=userid%>;
      var retailerId = <%=retailerId%>;
      
      function checkUserTimesheet(userId, tdate) {
     
          $.ajax({
              url: 'checkUserTimesheet',
              type: 'post',
              data: {
                  "userId": userId,
                  "tdate": tdate
              },
              success: function(data) {

                  if (data[1][0].status == 2 || data[1][0].status == 3) {
                     
                      $('#showBtn').html(submitedTimesBtn);

                  } else {
            
                       $('#showBtn').html(resettimesheetBtn);
                       $('#showBtn').append(savetimesheetBtn);
                       $('#showBtn').append(submitTimesBtn);
                  }
      
              for (var i = 0; i < curr_wbsnm.length + 3; i++) { 
                      for (var l = 0; l < data.length; l++) {
      var z=0;
                   for (var j = 0; j <= temp+1 ; j++) {
      
                                  if(i == curr_wbsnm.length + 1)
                                  {
                                       $('#id' + j+'_'+ i).val(0);
                                      var w1='';
                                              try{
                                           w1=new Date(data[3][z].date);
      
                                            }
                                            catch(e)
                                            {
      
                                                w1='';
                                           }
      
                                            var w2=new Date($('#t_h' + j).val());
                                           
      
      var day1=new Date(w1);
      var day2= new Date(w2);
                                      if(day1.getDate()==day2.getDate()){
                                           
                                         
                                  $('#id' + j+'_'+ i).val(data[3][z].Thumbhours);
                                   z++; 
                              }
                              else
                                 $('#id' + j+'_'+ i).val(0);
      
      }
                           if(j==temp+1 && i == curr_wbsnm.length + 1){
                               try{
      $('#id' + j+'_'+ i).val(data[4][0].totalThumbhours ||0);
    
                            }
                            catch(e)
                            {
      $('#id' + j+'_'+ i).val(0);
                            }
                           }
      
                              
     
                             
                          }
                      }
                  }
      
                  for (var i = 0; i < curr_wbsnm.length + 1; i++) { 
                      for (var l = 0; l < data[0].length; l++) {
      
                          if (data[0][l].timeAssignmentId == $('#id_asmt' + i).val()) {
                            
                              for (var j = 0; j <= temp + 1; j++) {
      
                                  var days = alldays[j];
                                
                                  if (data[0][l][days] != 0) {
                                      $('#id' + j+'_'+ i).val(data[0][l][days]);
                                  } else {
                                      $('#id' + j+'_'+ i).val();
                                  }
                                  if (j == temp + 1)
                                      $('#id' + j+'_'+ i).val(data[0][l].total);
                              }
      
                          }
                      }
                  }
      
      
                  document.getElementById('timestatus').innerHTML = for_status[data[1][0].status];
                  if (data[1].length == 0) { 
                      document.getElementById('timestatus').innerHTML = "Draft";
                  } else {
                      document.getElementById('timestatus').innerHTML = for_status[data[1][0].status];
                  }
                  
              }
      
          });
      }
     
      function parseDate(input) {
      var parts = input.match(/(\d+)/g);
      return new Date(parts[0], parts[1]-1, parts[2]);
      }
      
      
      function abc(year1, mon1, dy1)
      {
      
          curr_wbsnm = [];
          curr_asgnmnt_id = [];
          no_of_asgmnt = 0;
          mon1 = parseInt(mon1);
          var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      
          if (ftdy) {
              var no_of_days;
              if (dy1 < 15 || dy1 == 15) {
                  no_of_days = 15;
                  var stdate = monthNames[mon1 - 1] + " 1 " + year1;
                  var eddate = monthNames[mon1 - 1] + " 15 " + year1;
                  var mname = monthNames[mon1 - 1];
                  $('#startingdate').text(stdate);
                  $('#enddate').text(eddate);
                  eddate1 = " 15 " + "-" + monthNames[mon1 - 1] + "-" + year1;
                  eddate2 = parseDate(year1 + " " + mon1 + " " + 15);
                  $('#submitdate').val(eddate1);
             
                    var datefortimes = parseDate(year1 + " " + mon1 + " " + 15);
                  checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' + datefortimes.getDate();
                
      
                  stdate = stdate.toString();
                  eddate = eddate.toString();
                  var a = stdate.length;
                  var b = eddate.length;
                  st1 = stdate[a - 7] + stdate[a - 6];
                  ed1 = eddate[b - 7] + eddate[b - 6];
                  temp = 14;
      
               
                  var new1 = parseDate(year1 + " " + mon1 + " " + 1);
                   var datefortimes = parseDate(year1 + " " + mon1 + " " + 15);
                  EligibleAssignment(new1, datefortimes);
      
                  Drawtimesheet(year1, mon1, dy1);
                  $('#bdy').html(t);
                    $('#am').html(t1);
                  checkUserTimesheet(userId, checkdate);
      
                  disableHoliday();
          
              } else {
                  var stdate = monthNames[mon1 - 1] + " 16 " + year1;
                  var eddate = monthNames[mon1 - 1] + " " + new Date(year1, mon1, 0).getDate() + " " +
                      year1;
                  stdate = stdate.toString();
                  eddate = eddate.toString();
                  var a = stdate.length;
                  var b = eddate.length;
                  st1 = stdate[a - 7] + stdate[a - 6];
                  ed1 = eddate[b - 7] + eddate[b - 6];
                  temp = ed1 - st1;
                 new1=parseDate(year1 + " " + mon1 + " " + 16);
                  if (temp == 15) {
                      eddate1 = "31" + "-" + monthNames[mon1 - 1] + "-" + year1;
                      eddate2 = parseDate(year1 + " " + mon1 + " " + 31);
                      var datefortimes = parseDate(year1 + " " + mon1 + " " + 31);
                      checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' +
                           datefortimes.getDate();
                  } else
      
                  if (temp == 14) {
                      eddate1 = "30" + "-" + monthNames[mon1 - 1] + "-" + year1;
                      eddate2 = parseDate(year1 + " " + mon1 + " " + 30);
      
                 
      var datefortimes = parseDate(year1 + " " + mon1 + " " + 30);
      
      
      
      
                      checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' +
                          datefortimes.getDate();
      
                  } else
      
                  if (temp == 13) {
                      eddate1 = "29" + "-" + monthNames[mon1 - 1] + "-" + year1;
                      eddate2 = parseDate(year1 + " " + mon1 + " " + 29);
                     var datefortimes = parseDate(year1 + " " + mon1 + " " + 29);
                      checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' +
                          datefortimes.getDate();
                  } else
      
                  if (temp == 12) {
                      eddate1 = "28" + "-" + monthNames[mon1 - 1] + "-" + year1;
                      eddate2 = parseDate(year1 + " " + mon1 + " " + 28);
                      var datefortimes = parseDate(year1 + " " + mon1 + " " + 28);
                      checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' +
                          datefortimes.getDate();
                      checkUserTimesheet(userId, checkdate);
                     var datefortimes = parseDate(year1 + " " + mon1 + " " + 28);
                   
                  }
      
      
                  EligibleAssignment(new1, datefortimes);
      
                  $('#submitdate').val(eddate1);
                 
      
                  Drawtimesheet(year1, mon1, dy1);
                  $('#bdy').html(t);
                  $('#am').html(t1);
                  checkUserTimesheet(userId, checkdate);
                  disableHoliday();
              }
      
          }
          if (weekdy) {
              var wkdate = mon1 + "/" + dy1 + "/" + year1;
              var wkdate = new Date(wkdate);
      
              var first = wkdate.getDate() - wkdate.getDay();
              var last = first + 6;
              var firstday = new Date(wkdate.setDate(first)).toUTCString();
      
              var lastday = new Date(wkdate.setDate(wkdate.getDate() + 6)).toUTCString();
              firstday = new Date(firstday);
              firstday.setDate(firstday.getDate() + 1);
              lastday = new Date(lastday);
              lastday.setDate(lastday.getDate() + 1);
              EligibleAssignment(firstday, lastday);
              ed = lastday.getDate();
              st1 = firstday;
              ed1 = lastday;
              eddate1 = ed + "-" + monthNames[lastday.getMonth()] + "-" + year1;
              eddate2 = ed1;
              $('#submitdate').val(eddate1);
              checkdate = lastday.getFullYear() + '-' + (lastday.getMonth() + 1) + '-' +
                  lastday.getDate();
              temp = 6;
              Drawtimesheet(year1, mon1, dy1);
              $('#bdy').html(t);
              $('#am').html(t1);
              checkUserTimesheet(userId, checkdate);
              disableHoliday();
      
          }
      
      
      
      
      /*--------------------------------------logic for monthly timesheet  date adjust-------------------------*/
      
      
          if(monthly)
          {
      
              
                var mndate = mon1 + "/" + dy1 + "/" + year1;
                var mndate = new Date(mndate);
            
                var firstDay = new Date(mndate.getFullYear(), mndate.getMonth(), 1);
                var lastDay = new Date(mndate.getFullYear(), mndate.getMonth() + 1, 0);
                EligibleAssignment(firstDay, lastDay);
                ed = lastDay.getDate();
                st1 = firstDay;
                ed1 = lastDay;
                eddate1 = ed + "-" + monthNames[firstDay.getMonth()] + "-" + year1;
                eddate2 = ed1;
      
                $('#submitdate').val(eddate1);
                checkdate = lastDay.getFullYear() + '-' + (lastDay.getMonth() + 1) + '-' +
                  lastDay.getDate();
                temp = lastDay.getDate()-1;
               
                Drawtimesheet(year1, mon1, dy1);
                $('#scroll').addClass('scrollit');
                $('#bdy').html(t);
                $('#am').html(t1);
      
                checkUserTimesheet(userId, checkdate);
                disableHoliday();
          }
                   
      }
      
      function EligibleAssignment(new1, datefortimes) {
          <% for(var i=0;i<timeinfo[2].length;i++)
         { %>
      
          var ty = new Date('<%=timeinfo[2][i].AssignmentDate%>');
          var tn = new Date('<%=timeinfo[2][i].deActivationDate%>');
           
      
          if(ty<=tn){
          if ((new1 <= ty && ty <= datefortimes) || (new1 <= tn && tn <= datefortimes) || (datefortimes <= tn && ty <= new1)) {
              
              curr_wbsnm[no_of_asgmnt] = '<%=timeinfo[2][i].WBSName%>';
              curr_asgnmnt_id[no_of_asgmnt] = '<%=timeinfo[2][i].id%>';
              curr_wbs_id[no_of_asgmnt] = '<%=timeinfo[2][i].WBSID%>';
              no_of_asgmnt++;
          }
      }
      
          <%}%>
          for (var i = 0; i < no_of_asgmnt; i++) {
          }
      }
      
      function Drawtimesheet(year1, mon1, dy1) {
      
          t = '';
          t1= '';
          $('#bdy').html('');
            $('#am').html('');
          var a1 = '';
          var a2 = '';
          var a3 = '';
          var a = '';
          var b='';
          for (var j = 0; j <= no_of_asgmnt + 2; j++) {
      
              if (j == 0) {
                  a1 = a1 + '<tr style="  ;font-size: 13px;font-weight:700;"><td style="max-width:200px"><input type="text"  style="width:200px;height:49px; text-align: center; " value="Assignment" disabled></input></td>';
                  a3 = a3 + '<td><input type="text" style="width:60px; height:49px;text-align:center;" value="Total" disabled></input></td></tr>';
      
                  if (ftdy) {
                      for (var k = st1; k <= ed1; k++) {
      
      
                          startdd = new Date(year1, mon1 - 1, k);
      
      
                          var current_date = startdd;
                          var weekday_value = current_date.getDay();
      
                          a2 = a2 + '<td><input type="hidden" ';
                          if (dy1 <= 15) {
                              a2 = a2 + 'id=t_h' + (k - 1);
                          } else {
                              a2 = a2 + 'id=t_h' + (k - 16);
                          }
      
                          a2 = a2 + ' value="' + startdd + '" ><input id="wkd' + (k - 1) + '" type="text" style="width:60px; height:49px; text-align:center"; value=' + k + "-" + weekdays[weekday_value] + ' disabled></input></td>';
      
      
                          var dateString1='<%=timeinfo[10][0].createdDate%>';
                          dateString1=new Date(dateString1).toUTCString();
                          dateString1=dateString1.split(' ').slice(0, 4).join(' ');
                          dateString2=new Date(startdd).toUTCString();
                          dateString2=dateString2.split(' ').slice(0, 4).join(' ');
                            
                            if(dateString1==dateString2)
                            {
                              $(".fadeLeftIcon").removeClass("hide");
                              $(".leftIcon").addClass("hide");
                            }
      
                          
                      }
                  }
      
                  if (weekdy || monthly) {
      
                      for (var p = 0; st1 <= ed1; p++) {
      
                          k = st1.getDate();
      
                          var weekday_value = st1.getDay();
      
      
                          a2 = a2 + '<td><input type="hidden" ';
      
                          a2 = a2 + 'id=t_h' + p;
      
      
                          a2 = a2 + ' value="' + st1 + '" ><input id="wkd' + p + '" type="text" style="width:60px; height:49px; text-align:center "; value=' + k + "-" + weekdays[weekday_value] + ' disabled></input></td>';
      
                          st1.setDate(st1.getDate() + 1);
      
                            var dateString1='<%=timeinfo[10][0].createdDate%>';
                          dateString1=new Date(dateString1).toUTCString();
                          dateString1=dateString1.split(' ').slice(0, 4).join(' ');
                          dateString2=new Date(st1).toUTCString();
                          dateString2=dateString2.split(' ').slice(0, 4).join(' ');
                            
                            if(dateString1==dateString2)
                            {
                              $(".fadeLeftIcon").removeClass("hide");
                              $(".leftIcon").addClass("hide");
                            }
      
      
                      }
                  }
              
                    a=a2+a3;
                    b='<tr >'+a1+'<tr>';
      
              }
      
              for (var i = 0; i <= temp + 1; i++) {                      
                  a = a + '';
               
                  if (i == 0 && j < no_of_asgmnt ) {
                      b = b + '<td style="max-width:200px;"><input type="hidden" id="id_asmt' + j + '" value="' + curr_asgnmnt_id[j] + '" ><input  type="text"  style="width:200px; color: #000000;text-align: center;height:20px" value="' + curr_wbsnm[j] + '" disabled></input></td>';
                  }
                  if (i == 0 && j == no_of_asgmnt) {
                      b = b + '<td style="max-width:200px;font-weight:700;"><input type="hidden" id="id_asmt' + j + '" value="#" ><input  type="text"  style="width:200px; color: #000000;text-align: center;" value="Total Hours" disabled></input></td>';
                  }
                  if (i == 0 && j == no_of_asgmnt + 1) {
                      b = b + '<td style="max-width:200px;font-weight:700"><input  type="text"  style="width:200px; color: #000000;text-align: center;" value="Thumb Hours" disabled></input></td>'
                  }
                  if (i == 0 && j == no_of_asgmnt + 2) {
                      b = b + '<td style="max-width:200px;font-weight:700"><input  type="text"  style="width:200px; color: #000000;text-align: center;" value="Work Schedules" disabled></input></td>'
                  }
                  if (i < temp+1 && j == no_of_asgmnt + 2) {
                      a = a + '<td style="color:#560F03;font-weight:bolder"><input id="id' + i + '_' + j + '"  disabled value='+workschedule+'  type="text" style="width:60px; text-align:center;" </input></td>'
                  } else
                  if (i < temp+1 && j == no_of_asgmnt ) {
                      a = a + ' <td><input disabled id="id' + i + '_' + j + '" value="0" class="abc numeric clearAllfield" type="text" style="width:60px; text-align:center; " onkeypress="return isNumber(event)"></input> </td>'
                  }
                  else
                  if (i < temp+1 && j == no_of_asgmnt+1 ) {
                      a = a + ' <td><input disabled id="id' + i + '_' + j + '" value="" class="abc numeric clearAllfield" type="text" style="width:60px; text-align:center; " onkeypress="return isNumber(event)"></input> </td>'
                  } else
                  if (i == temp + 1) {
                      a = a + '<td><input id="id' + i + '_' + j + '" disabled  type="text" style="width:60px; text-align:center; " value="0" font-weight:700" ></input> </td> '
                  } else 
                  /*if(curr_wbsnm[j]=='Holiday')
                  {
                     a = a + '<td><input  readonly id="id' + i + '_' + j + '" type="number"  class="abc text-hover numeric clearAllfield"  style="width:60px; text-align:center; " value=""   onkeypress="return isNumber(event)"></input> </td> '
                  }
                    else*/
                  {
                      a = a + '<td><input  id="id' + i + '_' + j + '" type="number"  class="abc text-hover numeric clearAllfield "  style="width:60px; text-align:center; " value="" onblur="sum(' + i + ',' + j + ')" onkeypress="return isNumber(event)"></input> </td> '
                  }
      
              }
              t = t + '<tr>' + a + '</tr>';
              t1= t1+ '<tr style="">' + b + '</tr>';
              a = '';
              b = '';
      
          }
      
      }
      
      
      function isNumber(evt) {
      
      evt = (evt) ? evt : window.event;
      var charCode = (evt.which) ? evt.which : evt.keyCode;
      if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode !=46  ) {
      return false;
      }
      return true;
      }
      
      
   </script>
   <style>
   </style>
   <% include ../partials/adminheader %>
      <div class="hide row sub-header" id="OtherEmp" style="min-height: 0px">
        <div class="col-g-1 col-md-1 col-sm-1"></div>
        <div class="col-g-3 col-md-3 col-sm-3" id="myrep_drop"></div>
        <div class="col-g-4 col-md-4 col-sm-4"></div>
        <div class="col-g-3 col-md-3 col-sm-3" id="drop"></div>
        <div class="col-g-1 col-md-1 col-sm-1">
          <button type="button" style="float:right;font-size:10px;margin-top: 5px;" class="btn btn-primary" onClick="timehome()">Own TimeSheet</button>
        </div>
        
      </div>
      <div class="row sub-header" id="headerTime" align="center" style="min-height: 0px">
         <div id="for_name" class="col-md-4" style="padding-top:4px;padding-left:5%">
            <label class="labelHead">Name  :  </label> <label><%=user%> </label>
            <%if(assetrole==1){%>
            <button type="button" class="btn " style="font-size:10px; height: 26px; "  data-toggle="modal" data-target="#myModal">Upload Attendance</button>

            <%}%>


                        <%if(roleid==1){%>
             <button type="button" class="btn " onclick="getFortnight()" style="font-size:10px; height: 26px; "  data-toggle="modal" data-target="#myModal2">Leave Report</button>
            <%}%>

            <div class="modal fade" id="myModal" role="dialog">
               <div class="modal-dialog">
                  <div class="modal-content">
                     <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" style="color:white">Upload Attendance</h4>
                     </div>
                     <div class="modal-body">
                        <form action="/uploadattendance" method="post" enctype="multipart/form-data">
                           <div class="row">
                              <div class="col-md-12">
                                 <div class="col-md-3"> <label for="file">Filename 1: </label></div>
                                 <div class="col-md-6"> <input type="file" name="file" id="file" required/></div>
                              </div>
                              <div class="col-md-12">
                                 <div class="col-md-3"> <label for="file">Filename 2: </label></div>
                                 <div class="col-md-6">   <input type="file" name="file" id="file2" required/></div>
                              </div>
                           </div>
                     </div>
                     <div class="modal-footer">
                         <center>
                           <button type="submit" name="submit" value="Submit" class="btn btn-default" >Submit</button>
                           <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                         </center>
                         </form>
                     </div>
                  </div>
               </div>
            </div>
      
             <div class="modal fade" id="myModal2" role="dialog">
               <div class="modal-dialog">
                  <div class="modal-content">
                     <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" style="color:white">Leave-Hours Report</h4>
                     </div>
                     <div class="modal-body">
                            <div class="row" style="width: 75%;margin-left: 70px;">
                                <select style="color: black" id="Leave"  name="Leave-Hours"  multiple="multiple" data-placeholder="choose fortnight">

                                </select>
                           </div>
                     </div>
                     <div class="modal-footer">
                         <center>
                           <button type="submit" name="submit" value="Submit" class="btn"  onclick="downloadLeaveReport()">Download</button>
                           <button type="button" id="close1" class="btn" data-dismiss="modal">Close</button>
                         </center>
                         
                     </div>
                  </div>
               </div>
            </div>





         </div>
         <div id="to_fro_date" style="text-align-last: center; height:34px;width:263px; background-color:white; margin-top: -2px; border-radius: 25px;">
            <img type="button" id="prevdate" src="../img/bug/left.jpg" class="shadow glyphicon leftIcon" style="top: -1px;" title="Previous" height="15px" title="" width="15px" onClick="getdateprev()">
            <img type="button" id="prevdate1" src="../img/bug/leftFade.png" class="  fadeLeftIcon hide" style=" " title="Previous" height="15px" title="" width="15px" >
            <input disabled type="text" id="submitdate" style="margin-top:3px;text-align: center;font-size:12px" value="">
            <img type="button" id="nextdate" src="../img/bug/Right.jpg" title="Next" class="shadow glyphicon" style="top: -1px;" height="15px" title="" width="15px" onClick="getdateuser()">
            <span id="StartDate" name="StartDate" class="glyphicon glyphicon-calendar" style="top:3px; margin-right:-5px;" title=" Select Calender"></span>
         </div>
         <div id="for_status" class="col-md-3" style=" text-align:right;   margin-top: 4px;">
            
            <label class="labelHead">Status  :  </label>
            <label id="timestatus">Draft</label>
         </div>
         <div id="app_div" class="col-md-2" style="         float: right;">
           
             <% if(timeinfo[12][0].timeApproval==1 || roleid==1) {%>
                    <button style="font-size:10px; height: 26px; width: 165px;float:right;margin-top:1px" type="button" class="btn " onClick="showDiv()">Approve Timesheet </button>
                    <%}%>
         </div>
      </div>
   <div   class="secondry-color">
      <div class="se-pre-con"></div>
   
      <div class="hide" style="min-height:300px" id="otherBlankDiv">
         <div  style="padding-left:30px;" class="center">
            <center><label style="color:#7e7e7e;font-size:20pt;">Timesheet Status</label></center>
         </div>
         <div class=" secondry-color row table-responsive" id="timesheet-table2" align="center">
            <table class="table stripe cell-border hover" id="for_approv">
               <thead>
                  <th>Employee Name</th>
                  <th>Employee Code</th>
                  <th>Status</th>
                  <th>View Timesheet</th>
               </thead>
               <tbody id="for_approv_body"></tbody>
            </table>
         </div>
      </div>
      <div id="MainTime" class="container-fluid" style="margin-top:3%">
         <div class="row tab-content" style="margin-left:3%; width:94%">
            <div class="row" style="">
               <div class="col-md-2 table-responsive" >
                  <table>
                     <tbody id="am"> 
                     </tbody>
                  </table>
               </div>
               <div class="col-md-10 table-responsive ">
                  <table id="eday" class="" style="margin-left: -6px;">
                     <tbody id="bdy0" >
                        <tr>
                           <td colspan="2">
                              <div  id="scroll" class=" table-responsive" >
                                 <table>
                                    <tbody id="bdy">
                                    </tbody>
                                 </table>
                              </div>
                           </td>
                     </tbody>
                  </table>
               </div>
            </div>
            <div class="text-center padTop10"><span class="error" id="errorTimesheetCommon"></span><span class="success" id="successTimesheetCommon"></span></div>
            <div id="ModalAdd"></div>
            <div id="showBtn" class="row" style="margin-left: 40%;padding-top:10px;"></div>
      
            <br>
            <br>
         </div>
      </div>
   </div>


   <script>
 
      


   var resetError = function() {
      $('.error').text("");
      $('.success').text('');
      }
      var commonTimeOut= function(name,time) {
      setTimeout(function(){ name.text(''); }, 5000);
      }
      function sum(a, b) {
        resetError();
        var errorTimesheetCommon= $('#errorTimesheetCommon');
        commonTimeOut(errorTimesheetCommon);
          var k = 0;
          for (var i = 0; i < no_of_asgmnt; i++) {
              var value = 0;
      
              var val = $('#id' + a+'_'+ i).val();
            
              if (val != "") {
                  value = parseFloat($('#id' + a+'_'+ i).val());
              } else {
                  var abc = 0;
              }
              k = k + value;
              if (k > 24.0) {
                  errorTimesheetCommon.text("time should not exceed than 24 hours");
                  $('#id' + a+'_'+ b).val(0);
                  sum(a, b);
                  return false;
              }
          }
          $('#id' + a+'_'+ i).val(k);
      }
      <!----------------------------------- FUNCTION FOR SUBMITTING ALL VALUES  -------------------------------------->
      function Totalsum(flag) {
      
        resetError();
         var successTimesheetCommon=$('#successTimesheetCommon');
         var errorTimesheetCommon= $('#errorTimesheetCommon');
  
          $(".se-pre-con").fadeIn("slow");
     
          var status = flag;
          var mangrId = <%=timeinfo[5][0].managerId%>;
          var curr1 = curr.toISOString().slice(0, 19).replace('T', ' ');
      
          var subdate = new Date(eddate2);
          sdate = subdate.getFullYear() + '-' + (subdate.getMonth() + 1) + '-' + subdate.getDate();
          var dayforsumbit = weekdays[curr.getDay()];
          var k1;
          for (var p = 0; p < no_of_asgmnt + 1; p++) {
              k1 = 0;
              for (var i = 0; i < temp + 1; i++) {
                  if ($('#id' + i+'_'+ p).val() != "")
                      k1 = k1 + parseFloat($('#id' + i+'_'+ p).val());
              }
              $('#id' + i+'_'+ p).val(k1);
                  
      
          }
      
         
      
          if (flag == 2) {
              var r = $('#id' + i+'_'+ (p - 1)).val();
              var r2 = $('#id' + i+'_'+ (p+1)).val();
      
              for (var i = 0; i < temp + 1; i++) {
                  var tdayhour = 0;
                  for (var j = 0; j < no_of_asgmnt; j++) {
                      var val = $('#id' + i+'_'+ j).val();
      
                      if (val != "") {
                          val = parseFloat(val);
                          tdayhour = tdayhour + val;
                      }
                  }
      
                  tdayhour = parseFloat(tdayhour);
                  var go_for_day = $('#t_h' + i).val();
                  var dayy = new Date(go_for_day);
                  var weekd = dayy.getDay();
                  var dnd = dayy.getDate();
      
                  if (tdayhour < workschedule) { 
                      if('<%=timeinfo[8][0].schedule%>'==1 || '<%=timeinfo[8][0].schedule%>'==''){
                      if (!(weekd == 6) ){
                       if(allowholiday(i,dnd))
                       {
                          status=1;
                           save_not_submit=1;
                          break;
                       }
                      }}
                      if('<%=timeinfo[8][0].schedule%>'==2){
                      if (!( weekd == 0)) {
                        if(allowholiday(i,dnd))
                        {
                          status=1;
                          save_not_submit=1;
                          break;
                        }
                      }}
                      if('<%=timeinfo[8][0].schedule%>'==3){
                      if (!(weekd == 0 || weekd == 6)) {
                        if(allowholiday(i,dnd))
                        { 
                          status=1;
                          save_not_submit=1;
                          break;
                        }
                      }}
                      if('<%=timeinfo[8][0].schedule%>'==4){
                      if (!(weekd == 0 || weekd == 6)) {
                        if(allowholiday(i,dnd))
                        { status=1;
                          save_not_submit=1;
                          break;   
                        }
                      }}
                  }
              }
      
      
      
             if ((status == 2) && (parseInt(r) < parseInt(r2))) {
              $(".se-pre-con").fadeOut("slow");
                  errorTimesheetCommon.text("your timesheet is incomlpete");
                  commonTimeOut(errorTimesheetCommon);
                  return false;
              }
             
      if (status == 2 && !confirm("Your Timesheet will be submitted to  -" + '<%=timeinfo[5][0].mngname%>')){
                  $(".se-pre-con").fadeOut("slow");
                  return false;
              }
      
          }
      

          $.ajax({
              url: 'submitTimesheet',
              type: 'post',
              data: {
                  "retailerId": retailerId,
                  "userId": userId,
                  "fillDate": curr1,
                  "date": sdate.toString(),
                  "day": curr.getDay(),
                  "totalHours": k1,
                  "status": status,
                  "supervisor": mangrId,
                  "approvedOrRejectedBy": '',
                  "approvedOrRejectedDate": curr1,
                  "rejectionReason": '',
                  "moduleType":'timesheet',
                  "editNotification":0
              },
              success: function(data) {
      
        
                  if(data[0].i=='6a'){
                      errorTimesheetCommon.text(" You have already submitted TimeSheet");
                      commonTimeOut(errorTimesheetCommon);
                      return false;
                  }
      
                  var alluser = [];
                  var assignments = [];
                  var wbsids = [];
                  var wbsname = [];
                   var report_data;
                  var report_data='';
                  for (var j = 0; j < no_of_asgmnt; j++) {
         
                      var tsid = data[0].i;

                      alluser.push(curr_asgnmnt_id[j]);
                      alluser.push(curr_wbs_id[j]);
                      alluser.push(tsid);
                   
                      for (var i = 0; i < temp + 2; i++) {
                          var colmid = i + "_" + j;
                          if ($('#id' + colmid).val() != 0)
                              var user = $('#id' + colmid).val();
                          else
                              var user = 0;
                          alluser.push(user);
                           if (($('#id' + colmid).val() != "" || $('#id' + colmid).val() != 0) && i < temp+1){


     var dddate = new Date($('#t_h'+i).val()).getFullYear() + '-' + (new Date($('#t_h'+i).val()).getMonth() + 1) + '-' + new Date($('#t_h'+i).val()).getDate();

                                          report_data=report_data+curr_asgnmnt_id[j]+","+curr_wbs_id[j]+","+tsid+",'"+dddate+"',"+$('#id' + colmid).val()+",'"+sdate+"'),(";

                            }
                          
                      }
                      
                      alluser.push('||');

                         
                  }



report_data=report_data.substring(0,report_data.length - 3);
                 
                  for (var j = no_of_asgmnt; j < no_of_asgmnt + 1; j++) {
                      alluser.push('"#"');
                      alluser.push('"#"');
                      alluser.push(tsid);
                      for (var i = 0; i < temp + 2; i++) {
      
                          var user = $('#id' + i+'_'+ j).val();
                          alluser.push(user);
                      }
                  }
                  alluser = alluser.join(',');
                  while (alluser.indexOf('|,') != -1)
                      alluser = alluser.replace(',||,', '||');

      
                  $.ajax({
                      url: 'submitTimesheetAssignment',
                      type: 'post',
                      data: {
                          "alluser": alluser,
                          "temp": temp,
                          "timesheetid": tsid,
                                     "report_data":report_data
                      },
                      success: function(data) {
      
                          if (status == 2){
                              $(".se-pre-con").fadeOut("slow");
              successTimesheetCommon.text("TimeSheet submitted successfully.");
              commonTimeOut(successTimesheetCommon);
             
                }
          else {
              if((save_not_submit!=1 || flag==1)&& flag!=0){
                     $(".se-pre-con").fadeOut("slow");
              successTimesheetCommon.text("Timesheet saved succesfully.");
              commonTimeOut(successTimesheetCommon);
         

            } }
              
          if (status == 2) {

                           $('#showBtn').html(submitedTimesBtn);

              document.getElementById('timestatus').innerHTML = for_status[status];
      
          } else {
                        $('#showBtn').html(resettimesheetBtn);
                       $('#showBtn').append(savetimesheetBtn);
                       $('#showBtn').append(submitTimesBtn);
 
              document.getElementById('timestatus').innerHTML = for_status[status];
          }
                      }
      
                    
      
      
      
                  });
              }
          });

              $(".se-pre-con").fadeOut("slow");
      }
      
      function getdateprev() {
        
          resetError();
          $('#showBtn').html('');
          $('#savetimesheet').removeClass('hide');
          $('#resettimesheet').removeClass('hide');
         
          document.getElementById('timestatus').innerHTML = for_status[flag];
 
          var tt = eddate2;
    
          var date = new Date(tt);
          var newdate = new Date(date);
          if (ftdy) {
              if (newdate.getDate() == 15)
                  newdate.setDate(newdate.getDate() - 15);
              else
              if (newdate.getDate() == 31)
                  newdate.setDate(newdate.getDate() - 16);
              else
              if (newdate.getDate() == 30)
                  newdate.setDate(newdate.getDate() - 15);
              else
              if (newdate.getDate() == 29)
                  newdate.setDate(newdate.getDate() - 14);
              else
              if (newdate.getDate() == 28)
                  newdate.setDate(newdate.getDate() - 13);
          }
          if (weekdy) {
              newdate.setDate(newdate.getDate() - 8);
          }
      
           if (monthly) {
              newdate.setDate(newdate.getDate() - 32);
          }
      
      
          var dd = ("0" + newdate.getDate()).slice(-2);
          var mm = ("0" + (newdate.getMonth() + 1)).slice(-2);
          var y = newdate.getFullYear();
           eddate2 = parseDate(y + " " + mm + " " + dd);
          var someFormattedDate = dd + '-' + monthNames[mm - 1] + '-' + y;
          document.getElementById('submitdate').value = someFormattedDate.toString();
         var datefortimes = parseDate(y + " " + mm + " " + dd);
          checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' + datefortimes.getDate();
         
          abc(y, mm, dd);
       
          OtherUsersLIst();
      
      }
      
      function getdateuser() {
        resetError();
          $('#showBtn').html('');
           $(".fadeLeftIcon").addClass("hide");
         $(".leftIcon").removeClass("hide");
      
          $('#savetimesheet').removeClass('hide');
          $('#resettimesheet').removeClass('hide');
          
          document.getElementById('timestatus').innerHTML = for_status[flag];
      
          var tt = eddate2;
        
          var date = new Date(tt);
          var newdate = new Date(date);
          a = newdate.getMonth();
          var y = newdate.getFullYear();
          var b = new Date(y, a + 1, 0).getDate();
      
          if (ftdy) {
              if (newdate.getDate() == 15) {
                  if (a == 0 || a == 2 || a == 4 || a == 6 || a == 7 || a == 9 || a == 11)
                      newdate.setDate(newdate.getDate() + 16);
                  else
                  if (a == 3 || a == 5 || a == 8 || a == 10)
                      newdate.setDate(newdate.getDate() + 15);
                  else
                  if (a == 1 && b == 28) { 
                      newdate.setDate(newdate.getDate() + 13);
                  } else
                  if (a == 1 && b == 29)
                      newdate.setDate(newdate.getDate() + 14);
              } else { 
                  newdate.setDate(newdate.getDate() + 15);
              }
      
          }
      
          if (weekdy) {
              newdate.setDate(newdate.getDate() + 6);
          }
      
      
           if (monthly) {
              newdate.setDate(newdate.getDate() + 1);
          }
      
          var dd = ("0" + newdate.getDate()).slice(-2);
          var mm = ("0" + (newdate.getMonth() + 1)).slice(-2);
          var y = newdate.getFullYear();
          eddate2 = y + " " + mm + " " + dd;
          var someFormattedDate = dd + '-' + monthNames[mm - 1] + '-' + y;
          document.getElementById('submitdate').value = someFormattedDate.toString();
          var datefortimes = new Date(eddate2);
          checkdate = datefortimes.getFullYear() + '-' + (datefortimes.getMonth() + 1) + '-' + datefortimes.getDate();
         
          abc(y, mm, dd);
        
          OtherUsersLIst();
        
      }
      
      function disableHoliday() {
       
          var k = curr_wbsnm.length + 2;
    
          for (var i = 0; i < temp + 1; i++) {
              var ddy = $('#t_h' + i).val();
              ddy = new Date(ddy);
              var weekday = ddy.getDay();
              var date_other_format = ddy.getFullYear() + '-' + (ddy.getMonth() + 1) + '-' + ddy.getDate();
              if ('<%=timeinfo[8][0].schedule%>' == '') {
                  if (weekday == 0) {
                      satsun(i, k,ddy);
                  } else disholi(i, k, date_other_format);
              } else
              if ('<%=timeinfo[8][0].schedule%>' == 4) {
      
      
                  if (weekday == 0 || weekday == 6) {
      
                      satsun(i, k,ddy);
      
                  } else
                      disholi(i, k, date_other_format);
              }
              if ('<%=timeinfo[8][0].schedule%>' == 1) {
      
      
                  if (weekday == 6) {
      
                      satsun(i, k,ddy);
      
                  } else
                      disholi(i, k, date_other_format);
              }
              if ('<%=timeinfo[8][0].schedule%>' == 2) {
      
      
                  if (weekday == 0) {
      
                      satsun(i, k,ddy);
      
                  } else
                      disholi(i, k, date_other_format);
              }
              if ('<%=timeinfo[8][0].schedule%>' == 3) {
      
      
                  if (weekday == 0 || weekday == 6) {
      
                      satsun(i, k,ddy);
      
                  } else
                      disholi(i, k, date_other_format);
              }
      
      
      
          }
          var s = 0;
          for (var i = 0; i < temp + 1; i++) {
              s = s + parseFloat($('#id'+i+'_'+k).val());
          };
          $('#id'+i+'_'+k).val(s);
      }
      
      function satsun(i, k,ddy) {
          for (var j = 0; j < curr_wbsnm.length; j++) {
              var abc = curr_wbsnm[j];
              var a=1;
              if (abc=='Holiday' || a==1) { 
                  document.getElementById("id" + i+"_"+ k).value = 0;
                  document.getElementById("id" + i+"_"+ curr_wbsnm.length).style.color = "rgb(10, 199, 80)";
                  document.getElementById("id" + i+"_"+ (curr_wbsnm.length+1)).style.color = "rgb(10, 199, 80)";
      
                  if(ftdy==1){
                 if(ddy.getDate()<=15){
                   document.getElementById("wkd" + i).style.color = "rgb(10, 199, 80)";
                   }
               else{
                    document.getElementById("wkd" + (i+15)).style.color = "rgb(10, 199, 80)";
                  }
              }
              if(weekdy==1 || monthly==1){
                  document.getElementById("wkd" + i).style.color = "rgb(10, 199, 80)";
              }
              }
              
          }
      }
      
      function disholi(i, k, date_other_format) {
          <% for (var k1 = 0; k1 < timeinfo[4].length; k1++) {%>
          var holidy = '';
          if ('<%=typeof(timeinfo[4][k1].holidaydate)%>');
          var holidy = new Date('<%=timeinfo[4][k1].holidaydate%>');
          var date_other_format_2 = holidy.getFullYear() + '-' + (holidy.getMonth() + 1) + '-' + holidy.getDate();
          if (date_other_format == date_other_format_2) {
              for (var j = 0; j < no_of_asgmnt; j++) {
                  var abc = curr_wbsnm[j];
                  if (abc=='Holiday') {
                      var p = k - 2;
                      
                      document.getElementById("id" + i+"_"+ j).disabled = true;
                      document.getElementById("id" + i+"_"+ j).value = workschedule;
                      document.getElementById("id" + i+"_"+ (k - 2)).value = workschedule;
                      document.getElementById("id" + i+"_"+ j).value = workschedule;
                     
                      $("#id" + i+"_"+ j).attr("title","<%=timeinfo[4][k1].holidayname%>");
                  }
              }
          }
          <% }  %>
      }
      
      function ClearAll() {
          $(".clearAllfield").val('');
          for (var j = 0; j <= no_of_asgmnt + 1; j++) {
           for(var i = 0; i <= temp + 1; i++){
                if (i < 31 && j == no_of_asgmnt)
                          {
                          document.getElementById("id" +i+"_" + j).value = 0;
                          }
                           else
                          if (i == temp + 1) 
                          {
                           document.getElementById("id" + i+"_"+ j).value = 0;   
                          }
      
      }
      }
      disableHoliday();
      Totalsum(0);
      }
      
      
      
      
      function timehome(){
        $('#headerTime').addClass('sub-header');
         $('#OtherEmp').addClass('hide');
          $("#otherBlankDiv").addClass("hide");
          $('#MainTime').removeClass('hide');
         $('#for_name').removeClass('hide'); 
          $('#for_status').removeClass('hide');
           $('#app_div').removeClass('hide');
          var move_to_fro = document.querySelector("#to_fro_date"); 
          move_to_fro.style.marginLeft="0px";
          move_to_fro.style.marginTop="0px";
      }
      function showDiv() {
          $('#headerTime').removeClass('sub-header');
          $('#OtherEmp').removeClass('hide');
          $("#otherBlankDiv").removeClass("hide");
          $('#MainTime').addClass('hide');
          $('#for_name').addClass('hide'); 
          $('#for_status').addClass('hide');
           $('#app_div').addClass('hide');
          
          var move_to_fro = document.querySelector("#to_fro_date");
          move_to_fro.style.marginTop="-46px";
          OtherUsersLIst();
      }
      
      
      function OtherUsersLIst(){
                      
          $.ajax({
              url: 'getUserUnderSupervisor',
              type: 'post',
              data: {
                  "cdate": checkdate
              },
              success: function(data) {
      otable.dataTable().fnDestroy();
                  $('#for_approv_body').html('');
                  $('#drop').html('');
                   $('#myrep_drop').html('');
      
                  if('<%=timeinfo[9][0].isRetailer%>'==1){
                  var string1='<select data-placeholder="All Employee" class="chosen-select" id="dropuserdata" onchange="DropdownUsers(1)" tabindex="2" ><option  value=0></option>';}
                  var string2='<select data-placeholder="My Reportee" name="myrep_dropUserD" class="chosen-select myrep_dropUserD" tabindex="2"  onchange="DropdownUsers(0);" id="myrep_dropuserD"><option value=0></option>';
                  for (var i = 0; i < data.length; i++) {
                     
                      if (for_status[data[i].status] != null) {
                           if('<%=timeinfo[9][0].isRetailer%>'==1){
                    var string1=string1 + '<option value="'+data[i].id+'">'+data[i].firstName+'-'+for_status[data[i].status]                     + '</option>';}
                     
                      if(data[i].managerId=='<%=userid%>'){
              
                      var string2=string2 + '<option value="'+data[i].id+'">'+data[i].firstName+'-'+for_status[data[i].status]                     + '</option>';
                  }
      
                          $('#for_approv_body').append('<tr><td style="width:150px;">'+data[i].firstName+'</td><td style="width:250px;">' + data[i].ecode + '</td><td style="width:150px;">' + for_status[data[i].status] + '</td><td style="width:150px; text-align:center;"><span onClick="Show_Other_timesheet('+data[i].id+')" class="glyphicon glyphicon-list-alt" title="View Timesheet"></span></td>');
      
      
      
                      } else {
                
                          if('<%=timeinfo[9][0].isRetailer%>'==1){
                          var string1=string1+'<option value="' + data[i].id + '">' + data[i].firstName + '-Draft</option>';}
                          if(data[i].managerId=='<%=userid%>'){
                          var string2=string2+'<option value="' + data[i].id + '">' + data[i].firstName + '-Draft</option>';
                                }
                          $('#for_approv_body').append('<tr><td style="width:150px;">'+data[i].firstName+'</td><td style="width:250px;">' + data[i].ecode  + '</td><td style="width:150px;"> Draft</td><td style="width:150px; text-align:center;"><span onClick="Show_Other_timesheet('+data[i].id+')" class="glyphicon glyphicon-list-alt" title="View Timesheet"></span></td>');
                      }
      
                  }
      
                   if('<%=timeinfo[9][0].isRetailer%>'==1){ string1=string1+'</select>';}
                   string2=string2+'</select>';
                 if('<%=timeinfo[9][0].isRetailer%>'==1){ $('#drop').html(string1);}
                 $('#myrep_drop').html(string2);
                
                 $('#for_approv').dataTable({
                                     "bInfo": false,"bLengthChange":false
                                   });
                 chosenSelectDropdown()
              }
      
      
          });
      }
    
      function Show_Other_timesheet(us_id){
            $.ajax({
                      url: '/otherTimeSheet_setPage',
                      type: 'post',
                      data: {
                          "id": us_id,
                           "time_date":checkdate                         
                      },
                      success:function(data){
                            
                            window.location.href = "/otherTimeSheet";
                      }
                  });
      }
        function DropdownUsers(flag) {
        
          if(flag==0)
          {
           var dpusdata = $('#myrep_dropuserD').val();
          }else
          {
           var dpusdata = $('#dropuserdata').val();
          }
           if(dpusdata==null){
             
              return false;
              }
          if (dpusdata!= 0){
               $.ajax({
                      url: '/otherTimeSheet_setPage',
                      type: 'post',
                      data: {
                          "id": dpusdata,
                          "time_date":checkdate,
                      },
                      success:function(data){
                            
                            window.location.href = "/otherTimeSheet";
                      }
                  });
          }
          
      }
      
        function allowholiday(i,dnd){
          resetError();
          var errorTimesheetCommon=$('#errorTimesheetCommon');
  
                      if (parseInt(dnd) < 16) {
                        errorTimesheetCommon.text("Total Hours on "+ $('#wkd' + i).val() + " is less then "+workschedule+" hours");
                        commonTimeOut(errorTimesheetCommon);
                            
                              document.getElementById('timestatus').innerHTML = "Active";
                              return 1;
                          } else {
                              if(weekdy==1 || monthly==1){
                              errorTimesheetCommon.text("Total Hours on "+$('#wkd'+i).val()+ " is less then "+workschedule+" hours");
                              commonTimeOut(errorTimesheetCommon);
                                   
                              }
                              else
                              {
                                errorTimesheetCommon.text("Total Hours on "+$('#wkd'+(i + 15)).val()+ " is less then "+workschedule+" hours");}
                                commonTimeOut(errorTimesheetCommon);
                              document.getElementById('timestatus').innerHTML = "Active";
                              return 1;
                          
                         
              }
          }
      
    function getFortnight()
      {
        $('#Leave').html('');
        $.ajax({
            url: '/getFortnightDate',
            method: 'POST',
             
            success: function(data) {
              data1=data
               var row='';
                for(var i=0;i<data.length;i++)
                {
                  var td1=new Date(data[i].fortnight);
              var dd1=td1.getDate();
              var mm1=td1.getMonth();
              mm1=mm1+1;
              var yr1=td1.getFullYear();
              var edate=yr1+"-"+mm1+"-"+dd1;

               row=row+"<option value="+data[i].fortnight+">"+data[i].fortnight+"</option>";
                }
      

            $('#Leave').append(row);  
             $('#Leave').change(function() { 
                 }).multipleSelect({
                     width: '100%'
                });

            
            dataType: 'JSON'
                }
        });
    }  

function downloadLeaveReport()
{ var  dates='';
  var dates1=[];
  var dates1=$("#Leave").val().toString().split(",");
  for(var i=0;i<dates1.length;i++){
    var log=dates1[i];
    dates=dates+log+" "+"00:00:00"+",";
  }
var header=['EmpName', 'EmpCode', 'Hours', 'LeaveDate'];
var url = window.location.origin.split("/")[3] ? window.location.origin : window.location.origin + '/getAllEmpLeaveHours';
$.ajax({
url: url,
method: 'POST',
data : {"dates":dates},
success: function(LeaveData) { 
  $('#close1').click();
LeaveData.unshift(header);
alasql("SELECT * INTO CSV('Leave_Report.csv') FROM ?",[LeaveData]);
},
dataType: 'JSON',
});   
$(".se-pre-con").fadeOut("slow");
}


      
      
      function validateThumbfiles(){
      
      if($("#file1").val()=="" ){
          alert("Upload file 1");
      }
      else
       if($("#file2").val()=="" ){
          alert("Upload file 2");
      }else{
          $('#fordismiss').trigger('click');
      }   
         }
     function confirmBox(msg) { 
     var confirmBox ='<div class="modal fade" id="activeTimesheetModal" role="dialog"><div class="modal-dialog"><div class="modal-content" id="activeTimesheetCnfrmMsgBox"> <div class="modal-header text-center" style="border-top:0px;"> <span>Message</span> </div><div class="modal-body text-center"> <span id="cMessage1">'+msg+'</span> </div><div class="modal-footer text-center" style="border-top:0px;"> <button id="activeTimesheetCloseMessage" type="reset" data-dismiss="modal" class="btn btn-default" style="background-color:#f05f40;color:white;padding-top: 4px; width:100px;height:30px;margin-top:10px;" onclick="return false;">Cancel</button> <button id="activeTimesheetActive" type="button" data-dismiss="modal" class="btn btn-default" style="background-color:#f05f40;color:white;padding-top: 4px; width:100px;height:30px;margin-top:10px;" onclick="return true;">Ok</button> </div></div></div></div>';
      $("#ModalAdd").html(confirmBox);
      $("#activeTimesheetModal").modal("show");
      }
   </script>
   <script>
      function chosenSelectDropdown() {
         $('.chosen-select').chosen();
            $('.chosen-select-deselect').chosen({ allow_single_deselect: true });
      }
        
   </script>
   <% include ../partials/footer %>
   </body>
</html>
